\section*{Введение}

\subsection*{Актуальность}

Графовые модели данных широко используются в различных областях науки, например, в биоинформатике~\cite{Sevon08}, анализе социальных сетей~\cite{Zarrinkalam14, Chaudhary16}, графовых базах данных~\cite{Medeiros18,Yannakakis1990} и разных видах статического анализа~\cite{Reps1998}. 

Одной из важных задач в анализе графовых моделей данных является поиск путей с заданными ограничениями. Одним из способов задавать такие ограничения являются формальные языки: если на рёбрах графа написаны метки из фиксированного алфавита, то можно искать пути, конкатенация меток на которых принадлежит фиксированному языку~\cite{Barrett00}. Например, хорошо изучена задача поиска путей с ограничениями, заданными регулярными языками~\cite{Mendelzon1995}. В этой же работе мы остановимся на классе контекстно-свободных языков, так как они позволяют решать более широкий класс задач.

Задача поиска путей с контекстно-свободными ограничениями, или, сокращённо, CFPQ\footnote{Context-Free Path Querying} была впервые сформулирована в терминах запросов к графовым базам данных~\cite{Yannakakis1990}, но нашла применение и в прочих отраслях, использующих графовые модели. За более чем 30 лет, прошедших с тех пор, было предложено множество разных алгоритмов для её решения~\cite{Reps97, Hellings15, Santos18}, в большинстве своём основанных на различных методах синтаксического анализа. 

К сожалению, все существующие решения задачи в общем случае недостаточно эффективны для использования на практике~\cite{Kuijpers19}. Более того, существует условная нижная оценка~\cite{Heintze1997}, согласно которой, скорее всего, достаточно быстрых решений задачи CFPQ в общем случае и не существует.

Всё вышесказанное приводит к тому, что имеет смысл разрабатывать алгоритмы для частных случаев задачи, имеющие время работы лучше, чем общее решение. Для некоторых из этих случаев уже были построены подобные решения, например для языков Дика на двунаправленных графах~\cite{Yuan09,Chatterjee17}. Проблема существующих решений в том, что они слишком Ad hoc, то есть построены специально под конкретный частный случай, а потому применённые в них подходы и идеи невозможно переиспользовать при построении решений для других частных случаев.  

Данная работа нацелена на создание единого подхода к построению решений задачи для CFPQ и применение этого подхода для разработки на его основе новых решений для некоторых частных случаев задачи.

\subsection*{Постановка задачи}

% Помеченный граф
\begin{definition}
  \textit{Ориентированный помеченный граф} (или \textit{граф с метками})~--- это тройка $G = \q{V, E, \Sigma}$, где $V$~--- множество вершин, $\Sigma$~--- множество меток, \\$E \subseteq V \times V \times \Sigma$~--- множество рёбер. 

  Неформально, это мультиграф, каждому ребру которого сопоставлена метка из алфавита $\Sigma$.
\end{definition}

\begin{figure}[H]
  \begin{minipage}[h]{0.5\linewidth}
    \begin{tikzpicture}[shorten >=1pt, auto]
      \node[state] (q_0)                      {$0$};
      \node[state] (q_1) [above right=of q_0] {$1$};
      \node[state] (q_2) [right=of q_0]       {$2$};
      \node[state] (q_3) [right=of q_2]       {$3$};
      \path[->]
        (q_0) edge node {$a$} (q_1)
        (q_1) edge node {$a$} (q_2)
        (q_2) edge node {$a$} (q_0)
        (q_2) edge[bend left, above]  node {$b$} (q_3)
        (q_3) edge[bend left, below]  node {$b$} (q_2);
    \end{tikzpicture}
    \caption{Помеченный граф с $\Sigma = \{ a, b \}$}
  \end{minipage}
  \hfill
  \begin{minipage}[h]{0.5\linewidth} 
      \begin{tikzpicture}[shorten >=1pt, auto]
        \node[state] (q_0)                      {$0$};
        \node[state] (q_1) [above right=of q_0] {$1$};
        \node[state] (q_2) [right=of q_0]       {$2$};
        \node[state] (q_3) [right=of q_2]       {$3$};
        \path[->]
          (q_0) edge[ultra thick] node {$a$} (q_1)
          (q_1) edge[ultra thick] node {$a$} (q_2)
          (q_2) edge node {$a$} (q_0)
          (q_2) edge[bend left, above, ultra thick]  node {$b$} (q_3)
          (q_3) edge[bend left, below, ultra thick]  node {$b$} (q_2);
      \end{tikzpicture}
      \caption{На пути $v_0 \to v_1 \to v_2 \to v_3 \to v_2$\\ читается слово $aabb$}
    \end{minipage}
    \label{tikz:labeled_graph}
\end{figure}


\begin{definition}
  Будем говорить, что слово $w$ \textit{читается} на пути $p$, если конкатенация меток вдоль $p$ образует $w$. 
\end{definition}

% Контекстно-свободная грамматика
\begin{definition}
  \textit{Контекстно-свободная грамматика}~--- это четвёрка $\q{\Sigma, N, S, P}$:
  \vspace{-\topsep}
  \begin{itemize}
    \setlength\itemsep{-0.1em}
    \item $\Sigma$~--- конечный алфавит
    \item $N$~--- конечное множество нетерминалов
    \item $S \in N$~--- стартовый нетерминал
    \item $P$~--- конечное множество продукций (правил вывода), имеющих вид\\ $N_i \to \alpha$, где $N_i \in N, \alpha \in (\Sigma \cup N)^{*}$
  \end{itemize}

  Язык, распознаваемый грамматикой $\cool{G}$~--- язык $L(G)$ слов, выводимых из стартового нетерминала.

  Контекстно-свободная грамматика задаёт \textit{контекстно-свободный язык}.
\end{definition}

\begin{example}
  Опишем грамматику $\cool{G} = \q{\Sigma, N, S, P}$, задающую язык $L(\cool{G})$ слов вида $b^n a^m b^{2n}$

  Алфавит состоит из букв $a$ и $b$: $\Sigma = \{ a, b \}$, нетерминалов будет два: $S$~-- стартовый нетерминал и $A$~--- нетерминал для слов вида $a^m$. Также вывода слов в грамматике будут следующие продукции:

  \begin{align*}
    &S \to b S bb \\
    &S \to A \\
    &A \to a A \\
    &A \to \eps
  \end{align*}

  где $\eps$~--- пустое слово.

  Продукции для одного терминала иногда пишут через $|$ (логическое или), так что короткая запись грамматики для $L$ выглядит так:

  \begin{align*}
    L : &S ::= b S bb ~|~ A \\
    &A ::= aA ~|~ \eps
  \end{align*}

  Покажем, как в такой грамматике вывести слово `$bb\,aaa\,bbbb$':\\ $S \SO b\,S\,bb \SO  b\,b\,S\,bb\,bb \SO bb\,A\,bbbb \SO bb\,aA\,bbbb \SO bb\,aaA\,bbbb \SO bb\,aaaA\,bbbb \SO bb\,aaa\,bbbb$

\end{example}

Теперь определим саму задачу.

% Задача поиска путей с контекстно-свободными ограничениями
\begin{definition}
  Пусть даны ориентированный помеченный граф $G$ и контекстно-свободная грамматика $\cool{G}$ над тем же алфавитом.

  \textit{Задача поиска путей с контекстно-свободными ограничениями (CFPQ)}\footnote{В реляционной семантике запроса~\cite{Hellings16}} заключается в нахождении всех пар вершин $u, v \in V(G)$, таких что существует путь $p: u \path v$, на котором читается слово $w \in L(\cool{G})$.

  Например, для графа на рис.~\ref{img:path_0_2} и~\ref{img:path_3_1} показаны корректный и некорректный путь для языка $L : S ::= aSb ~|~ \eps$ слов $a^n b^n$.

  Корректным также будет являться и непростой путь $v_2 \to v_0 \to v_1 \to v_2 \to v_0 \to v_1 \to v_3 \to v_2 \to v_3 \to v_2 \to v_3 \to v_2$, на котором читается слово $aaaaaa\,bbbbbb$ ($a^6 b^6$).

\end{definition}

\begin{figure}[h]
  \begin{minipage}[h]{0.5\linewidth}  
    \begin{tikzpicture}[shorten >=1pt,auto]
       \node[state] (q_0)                      {$0$};
       \node[state] (q_1) [above right=of q_0] {$1$};
       \node[state] (q_2) [right=of q_0]       {$2$};
       \node[state] (q_3) [right=of q_2]       {$3$};
        \path[->]
        (q_0) edge[dkgreen, ultra thick] node {$a$} (q_1)
        (q_1) edge[dkgreen, ultra thick]  node {$a$} (q_2)
        (q_2) edge  node {$a$} (q_0)
        (q_2) edge[bend left, above, dkgreen, ultra thick]  node {$b$} (q_3)
        (q_3) edge[bend left, below, dkgreen, ultra thick]  node {$b$} (q_2);
    \end{tikzpicture}
    \caption{Корректный путь $v_0 \path v_2$}
    \label{img:path_0_2}
  \end{minipage}
  \hfill
  \begin{minipage}[h]{0.5\linewidth}  
    \begin{tikzpicture}[shorten >=1pt,auto]
       \node[state] (q_0)                      {$0$};
       \node[state] (q_1) [above right=of q_0] {$1$};
       \node[state] (q_2) [right=of q_0]       {$2$};
       \node[state] (q_3) [right=of q_2]       {$3$};
        \path[->]
        (q_0) edge[dkred, ultra thick] node {$a$} (q_1)
        (q_1) edge  node {$a$} (q_2)
        (q_2) edge[dkred, ultra thick]  node {$a$} (q_0)
        (q_2) edge[bend left, above]  node {$a$} (q_3)
        (q_3) edge[bend left, below, dkred, ultra thick]  node {$b$} (q_2);
    \end{tikzpicture}
    \caption{Некорректный путь $v_3 \path v_1$}
    \label{img:path_3_1}
  \end{minipage}
\end{figure}

\pagebreak

\subsection*{Цель и задачи}

Целью работы является получение решений для частных случаев задачи поиска путей с контекстно-свободными ограничениями, основанных на едином подходе.

Для её достижения решаются следующие задачи:
    \begin{itemize}
      \item Выбрать единый подход для решения задачи CFPQ
      \item Построить на его основе решения для следующих частных случаев:
        \begin{itemize}
          \item Язык Дика $\cool{D}_k$ на двунаправленных графах
          \item Язык Дика $\cool{D}_1$ (на одном типе скобок)
        \end{itemize}
      \item Применить выбранный подход для решения задачи достижимости для смешанного языка Дика $\cool{D}_1 \odot \cool{D}_1$ на двунаправленных графах
    \end{itemize}

\subsection*{Структура работы}

В главе~\ref{section:voda} приведена история развития области и анализ существующих решений для задачи CFPQ.

В главе~\ref{section:algo_idea} представлен выбранный подход к решению задачи CFPQ (идея пересечения языков).

В главе~\ref{section:bidirected} описан алгоритм, основанный на неориентированном инкрементальном транзитивном замыкании, и доказана его корректность для двунаправленных графов и языка Дика.

В главе~\ref{section:dyck_1} описан алгоритм, основанный на неинкрементальном транзитивном замыкании, и его применение для языка Дика на одном типе скобок.

В главе~\ref{section:dyck_1_1} описан алгоритм для смешанного языка Дика.

В последней главе подведены итоги, а также описаны возможные направления будущего развития.